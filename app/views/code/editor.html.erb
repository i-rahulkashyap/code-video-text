<div class="container my-5">
  <div class="row">
    <div class="col-12">
      <div class="editor-container mb-3">
        <textarea id="code-editor"></textarea>
      </div>
    </div>
    <div class="col-12">
      <h3>Output</h3>
      <pre id="output">No output yet...</pre>
      <button id="compile-btn" class="btn btn-primary mt-3">Compile</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.5/lib/codemirror.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.5/mode/javascript/javascript.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
      lineNumbers: true,
      mode: "javascript",
      theme: "material",
      tabSize: 2,
      lineWrapping: true, // Ensures long lines wrap to fit within the container
    });

    document.getElementById('compile-btn').addEventListener('click', () => {
      const code = editor.getValue();
      
      fetch('/code/compile', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({ code: code, language: 'javascript' })
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('output').textContent = data.result || "No output";
      })
      .catch((error) => {
        document.getElementById('output').textContent = `Error: ${error.message}`;
      });
    });
  });
</script>
